- release_file: /etc/grid5000/release

# Store G5K environment release information
- set_release:
  - exec_in: mkdir -p $(dirname $${release_file})
  - exec_in: echo "$${os_release}-x64-$${variant}-$${image_version}" >> $${release_file}
  # g5k_postinstall information should be set by the postinstall itself !
  #- exec_in: echo "$${g5k_postinst_path}" >> $${release_file}
  #- exec_in: echo "$${g5k_postinst_script}" >> $${release_file}
  # this extracts last git commit hash from local repo
  - pipe:
    - exec_local: |
        (cd ../.. && git rev-parse HEAD 2>/dev/null) || echo "Error: could not retrieve git sha1"
    - exec_in: cat - >> $${release_file}
