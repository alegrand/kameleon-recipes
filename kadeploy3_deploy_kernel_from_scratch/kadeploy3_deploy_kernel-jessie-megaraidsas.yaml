#==============================================================================
# vim: softtabstop=2 shiftwidth=2 expandtab fenc=utf-8 cc=81 tw=80
#==============================================================================
#
# DESCRIPTION: Kadeploy3 ramdisk OS (used in the deployment phase) for ARM64
#
# Notes:
# - force use of busybox rather than klibc-utils (which breaks the mount)
#
#==============================================================================
---
extend: kadeploy3_deploy_kernel-jessie.yaml

global:

bootstrap:
  - "@base"

setup:
  - "@base"
  - install_oot_megaraid-sas_driver:
    - add_oot_megaraid-sas_repo:
      - write_in:
        - /etc/apt/sources.list.d/megaraid-sas.list
        - |
          deb http://apt.grid5000.fr/megaraid_sas/ /
      - exec_in: apt-get update
    - install_driver:
      - exec_in: apt-get install --force-yes --allow-unauthenticated megaraid-sas-modules-3.16.0-5-amd64
export:
  - "@base"
